<template>
    <div v-if="dataReady" style="font-size: 10pt;">
<!-- Page 1 -->
        <div style="width: 120px; background: #666; color: #fff; padding: 16px; font-weight: bold;">
            <span style="font-size: 24pt;">Form</span> 
            <br>
            <span style="font-size: 40pt;">26</span>
        </div>

        <div style="width: 400px; margin-top: 200px; margin-bottom: 200px;">
            <h1>Request to File an Agreement <br> Form 26</h1>

            <p style="font-size: 12pt;">Provincial Court Family Rules</p>
        </div>


<!-- Page 2 -->
        <div class="new-page"></div>
        <div style="display: flex; border: 2px solid #333;padding: 8px;">
            <div style="width: 80%;">
                <b>You can complete and file most family forms online using the Family Law Act Online Forms Service.</b>
                <br>
                Access the service at <a href="http://justice.gov.bc.ca/apply-for-family-order" target="_blank">justice.gov.bc.ca/apply-for-family-order</a>. 
                <br>
                The free service includes guided pathways that ask you questions and put your answers into the required court forms. When you’re finished, you can save and file your forms electronically or print them to file in person.
            </div>
            <div style="width: 20%;">

            </div>
        </div>

        <div>
            A PDF version of this form is available online for download at <a href="www.gov.bc.ca/court-forms" target="_blank">www.gov.bc.ca/court-forms</a>.

            <br>

            <b>For courthouse locations, addresses, and contact information visit:</b>

            <br>
            <a href="http://www.gov.bc.ca/courthouselocations" target="_blank">http://www.gov.bc.ca/courthouselocations</a>

            <br>

            <b>Family law:</b>

            <br>

            The <a href="https://www.bclaws.gov.bc.ca/civix/document/id/complete/statreg/120_2020" target="_blank">Provincial Court Family Rules</a> set out the steps that you must take and the forms you must complete in a family law case. These rules apply t  o cases in Provincial Court about matters under the <a href="https://www.bclaws.gov.bc.ca/civix/document/id/complete/statreg/11025_00" target="_blank">Family Law Act</a> and the <a href="https://www.bclaws.gov.bc.ca/civix/document/id/complete/statreg/96127_01" target="_blank">Family Maintanance Enforcement Act</a>.

            <br>

            You can find the Rules and Acts on the BC Laws website at <a href="www.bclaws.gov.bc.ca" target="_blank">www.bclaws.gov.bc.ca</a>.
            
            <br>

            <div style="background-color: #666; color: #fff; font-size: 14pt; font-weight: bold; padding: 20px; text-align: center;">
                Preparing a Request to File an Agreement Form 26
            </div>

            Complete this form if you need to file a written agreement in Provincial Court. 
            
            <br>
            
            A written agreement that is filed in Provincial Court under the Family Law Act is enforceable under the Act as if it were an order of the Provincial Court.  

            <br>

            <b>
                How do I enforce a written agreement?
            </b>

            There  are  different  enforcement  options  available  under  the  Family  Law  Act  or  the  Family  Maintenance  Enforcement Act depending on what issues your written agreement is about. 

            <br>

            Enforcement actions under the Provincial Court Family Rules are set out in <a href="https://www.bclaws.gov.bc.ca/civix/document/id/complete/statreg/120_2020#part10" target="_blank">Part – 10 Enforcement</a>. 

            <br>

            <div style="border: 2px dashed #333; background: #d6d6d6; padding: 8px; ">
                <b>NOTE:</b> If you need help with paying or receiving child support or spousal support under an agreement,you may want to contact the BC Family Maintenance Agency first to see if they can help. 
                <br>
                Visit their website at <a href="www.bcfma.ca" target="_blank">www.bcfma.ca</a> or contact them by phone at 1-800-663-3455.
            </div>

            <div style="display: flex;">
                <div style="width: 50%; padding: 8px;">
                    <div style="background-color: #333; color: #fff;">
                        <b>Need legal help?</b>
                    </div>
                    It’s  important  to  understand  the  law  and  make  sure  you  have the right information. If   you don’t, it can make solving your problem harder. Getting  advice  from  a  lawyer  can  help. You can find a lawyer through:
                    <br>
                    <b>Lawyer Referral Service</b>
                    Visit <a href="www.accessprobono.ca/our-programs/lawyer-referral-service" target="_blank">www.accessprobono.ca/our-programs/lawyer-referral-service</a> or call at 604-687-3221 
                    <br>
                    <b>Legal Aid, Duty Counsel and Family Advice Lawyers</b>
                    Visit <a href="https://legalaid.bc.ca/" target="_blank">https://legalaid.bc.ca/</a> or call 1-866-577-2525
                    <br>
                    <b>Legal Services and Resources </b>
                    <br>
                    Visit the ClickLaw HelpMap at <a href="http://www.clicklaw.bc.ca/helpmap" target="_blank">http://www.clicklaw.bc.ca/helpmap</a> 

                    <div style="background-color: #333; color: #fff;">
                        <b>
                            Filling out the form and preparing to file it
                        </b>
                    </div>

                    <br>

                    Follow  the  instructions  in  the  form  and  include  all  the  information that is asked for.
                    <br>
                    <p>If you complete the form by hand, be sure it’s readable.</p>
                    <br>
                    <b>How do I prepare the form for filing? </b>
                    <ul>
                        <li>print   or   make   copies   of   the   completed   form   anddetermination: one set for you, one set for the court, andone set for each other party</li>
                    </ul>
                </div>
                <div style="width: 50%; padding: 8px;">
                    <div style="background-color: #333; color: #fff;">
                        <b>Filing the form at the registry</b>
                    </div>
                    After  you’ve  filled  out  the  form,  you  must  file  it at  the  <a href="https://www2.gov.bc.ca/gov/content?id=5AD9441AEBD9428FA6EF86D6B1E39E96" target="_blank">Provincial Court Registry:</a>

                    <br>

                    <ul>
                        <li>where  the  existing  Provincial  Court  case  with  thesame  parties  is  filed  (you  already  have  a  court  filenumber)</li>
                        <li>nearest to where the child lives most of the time, if thecase involves a child-related issue, or</li>
                        <li>nearest to where you live if the case does not involvea child-related issue</li>
                    </ul>

                    File the form:

                    <br>

                    <ul>
                        <li>electronically using the <a href="https://justice.gov.bc.ca/apply-for-family-order/" target="_blank">FLA Online Forms Service</a></li>
                        <li>in person at the court registry</li>
                        <li>by mail</li>
                        <li>by  email,  as  referenced  in  Notice  to  the  Professionand Public <a href="https://www.provincialcourt.bc.ca/downloads/Practice%20Directions/NP28.pdf" target="_blank">NP 28 Current Court Operations</a>, or</li>
                        <li>
                            by faxfiling using the <a href="https://www2.gov.bc.ca/assets/gov/law-crime-and-justice/courthouse-services/court-files-records/court-forms/family/pfa734.pdf?forcedownload=true" target="_blank">Fax Filing Cover PAge Form 52</a>
                        </li>
                    </ul>
                    <p>There  are  no  fees  for  filing  Provincial  Court  family  documents.</p>

                    <b>Be sure to bring all copies of the documents to the registry if you are filing in person. </b>
                    <p>The registry clerk will review your form to make sure it’scomplete before filing it. You’ll be given a copy for your records.</p>
                </div>
            </div>
        </div>

        <div class="new-page"></div>
<!-- <Page 3> -->
<!-- <HEADER> -->
        <FormHeader formName="Request to File an Agreement" formNumber="Form 26" formRuleNumber="Rule 132" :headerTableData="
            [{value: result.applicationLocation}, 
            {value: existingFileNumber}, 
            null, 
            {value: ''}]"></FormHeader>

        <div style="margin-bottom: 1rem;"></div>

        <div style="display: flex; flex-direction: row;">
            <div style="width: 80%; padding-right: 4px;">
                <div>
                    This Request to File an Agreement provides information about a written agreement that a person is filing under the Family Law Act in the Provincial Court. A written agreement that is filed in Provincial Court under the Family Law Act is enforceable under the Act as if it were an order of the Provincial Court.
                </div>
            </div>
            <div style="width: 20%;"></div>        
        </div>
        
<!-- <1> -->
        <div style="display: flex; flex-direction: row;">
            <div style="width: 80%; padding-right: 4px;">
                <FormPart :part="1" title="About the parties"></FormPart>

                <div style="margin-bottom: 1rem;">
                    <b>1. </b> 
                    <grey-box-form 
                        style="text-indent:2px;display:inline;" 
                        textwidth="25.6rem" 
                        beforetext="<b>My full name</b> is: " 
                        hint="Full name of party"
                        :hintFontSize="hintFontSize"
                        :hintTextColor="hintTextColor" 
                        :italicHint="false" 
                        :text="yourInfo.name | getFullName"
                    />
                </div>

                <div>
                    <grey-box-form 
                        style="display:inline;text-indent:2px;" 
                        textwidth="25.6rem" 
                        beforetext="My <b>date of birth</b> is: " 
                        hint="(dd/mmm/yyyy)" 
                        :hintFontSize="hintFontSize"
                        :hintTextColor="hintTextColor" 
                        :italicHint="false" 
                        :text="yourInfo.dob | beautify-date-mid"
                    />
                </div>
    
                <div style="margin-bottom: 1rem;"></div>

                <div> 
                    <b>3. </b>
                    <div style="display:inline;">
                        <GreyBoxForm  style="text-indent:2px;display:inline-block;" textwidth="19rem" beforetext="The <b>other party’s full name</b> is:" hint="" :italicHint="false" :text="otherPartyInfo[0].name | getFullName" />
                        <!-- <GreyBoxForm v-else style="text-indent:2px;display:inline-block;" textwidth="14.5rem" beforetext="The <b>other party’s full name</b> is:" hint="full name of the other party" :italicHint="false" text="" /> -->
                        <br>
                        <br>
                        <GreyBoxForm style="display:inline;text-indent:2px;margin-left:45px;" textwidth="14.7rem" hintMargin="10px" hintindent="4rem" beforetext="Their <b>date of birth</b>(dd/mmm/yyyy) is:" hint="" :italicHint="false" :text="otherPartyInfo[0].dob | beautify-date-mid" />
                        <!-- <GreyBoxForm v-else style="display:inline;text-indent:2px;" textwidth="16rem" beforetext="Their <b>date of birth</b>(dd/mmm/yyyy) is:" hint="date of birth (dd/mmm/yyyy)" :italicHint="false" text=" " /> -->
                    </div>
                    <div style="padding: 20px">
                        <check-box inline="inline" boxMargin="0" shiftmark="0" style="display:inline;" :check="otherPartyInfo.length > 1?'yes':''" text="There is an additional party"/>
                        <div>
                            <GreyBoxForm v-if="otherPartyInfo.length > 1 && otherPartyInfo[1].name" style="text-indent:2px;display:inline-block;" textwidth="14.5rem" beforetext="The <b>additional party’s</b> full name is:" hint="full name of the other party" :italicHint="false" :text="otherPartyInfo[1].name | getFullName"/>
                            <div v-else style="text-indent:2px;display:inline-block;margin-top:10px;"> 
                                <span style="display: inline">The <b>additional party’s</b> full name is:</span>
                                <div style="background-color:#d6d6d6;height: 22px; width: 250px; margin-top:-25px; margin-left: 252px;"></div>
                            </div>
                            <br/>
                            <GreyBoxForm v-if="otherPartyInfo.length > 1 && otherPartyInfo[1].dob" style="display:inline;text-indent:2px;" textwidth="6rem" beforetext="Their <b>date of birth</b>(dd/mmm/yyyy) is:" hint="date of birth (dd/mmm/yyyy)" :italicHint="false" :text="otherPartyInfo[1].dob | beautify-date-mid"/>
                            <div v-else style="text-indent:2px;display:inline-block;margin-top:10px;"> 
                                <p style="display: inline">Their <b>date of birth</b>(dd/mmm/yyyy) is:</p>
                                <div style="background-color:#d6d6d6; min-height: 22px; width: 250px;  margin-top:-25px; margin-left: 252px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="width: 20%;"></div>        
        </div>

        <div style="margin-bottom: 1rem;"></div>

        <div style="display: flex; flex-direction: row;">
            <div style="width: 80%; padding-right: 4px;">
                <FormPart :part="2" title="Request to file agreement"></FormPart>
   
                <div class="print-block" style="margin-top: 1rem;">
                    <div> 
                        <b>3. </b> <div style="margin:0rem 0 0 0.5rem; display:inline; font-size: 10">
                            <check-box 
                                boxMargin="0"
                                shiftmark="0"
                                inline="inline"
                                style="display:inline; margin:0 0.5rem 0 0;" 
                                :check="form26Info.filed?'yes':''" 
                                text="I <b>request to file a copy of the written agreement</b> dated,"/>               
                            <underline-form style="text-indent:1px;display:inline;" textwidth="7.25rem" beforetext="" hint="(dd/mmm/yyyy)" :text="form26Info.agreementDate | beautify-date-mid"/>
                            <div style="text-indent:0px;display:inline;"> between the above parties, in the Provincial Court.</div>
                        </div>              
                    </div>
                </div> 

            <!-- <4> -->
                <div class="print-block">
                    <div>
                        <b>4. </b>
                        <div style="margin:0 0 0 0.25rem;display:inline;  ">I am filing the written agreement <b>under the following provision(s)</b> of the Family Law Act:</div>
        
                        <div style="margin:0.25rem 0 0 1rem; " >
                            <i>Select all options that apply</i>                                   
                            <check-box                                                                                     boxMargin="0"
                                shiftmark="0"
                                :check="form26Info.agreementList.includes('section15')?'yes':''" 
                                text="section 15 <i>[when parenting coordinators may assist]</i>"/>               
                            <check-box
                                boxMargin="0"
                                shiftmark="0"
                                :check="form26Info.agreementList.includes('section44')?'yes':''" 
                                text="section 44 (3) <i>[agreements respecting parenting arrangements]</i>"/>   
                            <check-box
                                boxMargin="0"
                                shiftmark="0"
                                :check="form26Info.agreementList.includes('section58')?'yes':''" 
                                text="section 58 (3) <i>[agreements respecting contact]</i>"/>   
                            <check-box
                                boxMargin="0"
                                shiftmark="0"
                                :check="form26Info.agreementList.includes('section92')?'yes':''" 
                                text="section 92(e), (f) and (g) <i>[agreements respecting property division]</i>"/>
                            <check-box 
                                boxMargin="0"
                                shiftmark="0"                           
                                :check="form26Info.agreementList.includes('section148')?'yes':''" 
                                text="section 148 (2) <i>[agreements respecting child support]</i>"/>   
                            <check-box    
                                boxMargin="0"
                                shiftmark="0"                        
                                :check="form26Info.agreementList.includes('section163')?'yes':''" 
                                text="section 163 (3) <i>[agreements respecting spousal support]</i>"/>
                        </div>                        
                    </div>
                </div>

            </div>
            <div style="width: 20%;">
                <NoteBox>
                    <b-icon-paper />
                    <p>
                        You must file a copy of the written agreement along with this form.
                    </p>
                </NoteBox>

                <div style="margin-bottom: 1rem;"></div>
                
                <NoteBox>
                    <b-icon-info-circle-fill />
                    <p>                
                        To determine what section applies, look at the terms in written agreement to see what the agreement is about. It may be filed under more than one section of the Family LawAct if your agreement is about different issues.
                        <br>
                        Section 92 applies to agreements respecting companion animals
                    </p>
                </NoteBox>
            </div>        
        </div>

        <div style="margin-bottom: 1rem;"></div>

        <div style="display: flex; flex-direction: row;">
            <div style="width: 80%; padding-right: 4px;">
                <FormPart :part="3" title="Address for service"></FormPart>

                <div>
                    <b>5. </b>
                    <div style="display: inline; margin:0.25rem 0; text-indent:0px;">
                        My <b>address for service</b> of court documents and contact information is:
                        <br>
                        <i>You must provide an address for service and contact number, but it does not have to be your own if you don’t want to:</i>
                    </div>

                    <table class="compactfullsize" style="margin-top:0.5 !important; margin-left: 12px; font-size: 9pt; background-color: #dedede;">
                        <tr style="border:2px solid #fff">
                            <td colspan="3" style="border: 2px solid #fff; padding: 4px;">
                                Address: 
                                <div class="answer" style="background-color: #d6d6d6;">
                                    {{ yourInfo.address.street }} 
                                </div>
                            </td>
                        </tr>
                        <tr style="border:2px solid #fff">
                            <td style="border:2px solid #fff; padding: 4px;">City: <div class="answer" style="background-color: #d6d6d6;">{{ yourInfo.address.city }}</div>
                            </td>
                            <td style="padding-left:50px; border:2px solid #fff; padding: 4px;">Province: <div class="answer" style="background-color: #d6d6d6;">{{ yourInfo.address.state }}</div>
                            </td>
                            <td style="border:2px solid #fff; padding: 4px;">Postal Code: <div class="answer" style="background-color: #d6d6d6;">{{ yourInfo.address.postcode }}</div>
                            </td>
                        </tr>
                    </table>

                    <table class="compactfullsize" style="margin-top:0.5 !important; margin-left: 12px; font-size: 9pt; background-color: #dedede;">
                        <tr style="border:2px solid #fff">
                            <td style="border:2px solid #fff; padding: 4px;">Email: <div class="answer" style="background-color: #d6d6d6;">{{ yourInfo.contact.email }}</div>
                            </td>
                            <td style="border:2px solid #fff; padding: 4px;">Telephone: <div class="answer" style="background-color: #d6d6d6;">{{ yourInfo.contact.phone }}</div>
                            </td>
                        </tr>
                    </table>

                    <div style="margin-top: 1rem;"></div>
                
                    <table class="compactfullsize" style="margin-top:0.5 !important; margin-left: 12px; font-size: 9pt; background-color: #dedede;">
                        <tr style="border:1px solid #fff;">
                            <td v-if="yourInfo.lawyer" colspan="3" style="border:2px solid #fff; padding: 4px;">Lawyer (if applicable): 
                                <div class="answer" style="background-color: #d6d6d6;">
                                    {{ yourInfo.lawyerName | getFullName}}
                                </div>
                            </td>
                            <td v-else colspan="3" style="border:2px solid #fff; padding: 4px;" >Lawyer’s name and firm name (if applicable): </td>
                        </tr>
                    </table>
                </div>
                
            </div>
            <div style="width: 20%;">
                <NoteBox>
                    <b-icon-info-circle-fill />
                    <p>                
                        This information will be available to the other party and the court.
                    </p>
                </NoteBox>
            </div>        
        </div>



                 


    


        <div class="print-block mt-5"></div> 

    </div>
</template>

<script lang="ts">
import { Component, Prop, Vue } from 'vue-property-decorator';

import { namespace } from "vuex-class";   
import "@/store/modules/application";
const applicationState = namespace("Application");

import UnderlineForm from "@/components/utils/PopulateForms/components/UnderlineForm.vue";
import CheckBox from "@/components/utils/PopulateForms/components/CheckBox.vue";
import OrderedCheckBox from "@/components/utils/PopulateForms/components/OrderedCheckBox.vue";
import { nameInfoType, otherPartyInfoType } from "@/types/Application/CommonInformation";
import { yourInformationInfoDataInfoType } from '@/types/Application/CommonInformation/Pdf';
import { enfrcOtherPartyDataInfoType, form26InformationDataInfoType } from '@/types/Application/AgreementEnforcement/PDF';
import { enforceAgreementOrOrderSurveyDataInfoType } from '@/types/Application/AgreementEnforcement';
import { getYourInformationResults, getLocationInfo } from '@/components/utils/PopulateForms/PopulateCommonInformation';
import FormHeader from '@/components/utils/PopulateForms/components/FormHeader.vue';
import FormPart from '@/components/utils/PopulateForms/components/FormPart.vue';
import NoteBox from '@/components/utils/PopulateForms/components/NoteBox.vue';
import GreyBoxForm from '@/components/utils/PopulateForms/components/GreyBoxForm.vue';

@Component({
    components:{
        UnderlineForm,
        CheckBox,
        OrderedCheckBox,
        FormHeader,
        FormPart,
        NoteBox,
        GreyBoxForm     
    }
})

export default class Form26Layout extends Vue {

    @Prop({required:true})
    result!: any;    
    
    @applicationState.State
    public applicantName!: nameInfoType;    

    dataReady = false;   
    
    otherPartyInfo: enfrcOtherPartyDataInfoType[] = [];
    additionalOtherParties: enfrcOtherPartyDataInfoType[] = [];
    firstOtherParty = {} as enfrcOtherPartyDataInfoType;
    yourInfo = {} as yourInformationInfoDataInfoType;
    form26Info = {} as form26InformationDataInfoType;
    
    existingFileNumber = ''   
    
    hintFontSize = '8pt';
    hintTextColor = '#333';

    mounted(){
        this.dataReady = false;
        this.extractInfo();       
        this.dataReady = true;
    }
   
    public extractInfo(){
               
        this.otherPartyInfo=this.getOtherPartyInfo()        
        this.firstOtherParty = this.otherPartyInfo[0];
        if (this.otherPartyInfo?.length > 1) {
            this.otherPartyInfo.splice(0,1)
            this.additionalOtherParties = this.otherPartyInfo;
        }       
        
        this.yourInfo = this.getYourInfo();
        this.form26Info = this.getForm26Info();
        this.existingFileNumber = getLocationInfo(this.result.filingLocationSurvey);        
    } 
    

    
    public getYourInfo(){           

        if(this.result?.yourInformationSurvey){
            return getYourInformationResults(this.result?.yourInformationSurvey); 
        } 
        else
            return {} as yourInformationInfoDataInfoType
    }

    public getOtherPartyInfo(){

        let OpInformation: enfrcOtherPartyDataInfoType[] = [];        

        if (this.result.otherPartyCommonSurvey?.length > 0){
            OpInformation = [];
            const otherPartyData: otherPartyInfoType[] =  this.result.otherPartyCommonSurvey;
           
            for(const party of otherPartyData){ 
                const otherParty = {} as enfrcOtherPartyDataInfoType;               

                if (party.knowDob == 'y' &&  party.dob)
                    otherParty.dob = party.dob

                if (party.name)
                    otherParty.name = party.name;
                
                if (party.address)
                    otherParty.address = party.address;
                
                if (party.contactInfo)
                    otherParty.contactInfo = party.contactInfo;

                if (party.lawyer)
                    otherParty.lawyer = party.lawyer
                                
                OpInformation.push(otherParty)
            }
        } 

        return OpInformation
    }  
    
    public getForm26Info() {        

        const form26Information = {} as form26InformationDataInfoType;
        form26Information.agreementList = [];
        form26Information.agreementDate = '';        
        
        if (this.result?.enfrcQuestionnaireSurvey?.includes('writtenAgreementOrder') && this.result?.enforceAgreementOrOrderSurvey) { 

            const enfrcAgrmntOrdr: enforceAgreementOrOrderSurveyDataInfoType = JSON.parse(JSON.stringify(this.result.enforceAgreementOrOrderSurvey));

            const form26Conditions = (enfrcAgrmntOrdr.enforceOrder == "n") && (enfrcAgrmntOrdr.filedOrder == 'n') && (enfrcAgrmntOrdr.existingType == "writtenAgreement")

            form26Information.agreementDate = (form26Conditions)?Vue.filter('beautify-date')(enfrcAgrmntOrdr.existingDate):'';
            form26Information.agreementList = (form26Conditions)?enfrcAgrmntOrdr.agreementType:[];
            form26Information.filed = form26Conditions;
        }
        //console.log(form26Information)
        if(this.result?.enfrcQuestionnaireSurvey?.includes('parentingCoordinatorDetermination')){
            const detData  = this.result?.enforceChangeSetAsideDeterminationSurvey
            if(detData?.filedOrder == "n" && detData?.appointedDetermination?.selected == "writtenAgreement" && detData?.filedAgreement == "n"){
                form26Information.agreementList.push("section15");
                if(form26Information.agreementDate == ''){
                    form26Information.filed = true;
                    form26Information.agreementDate = Vue.filter('beautify-date-blank')(detData?.appointedDetermination?.writtenAgreementDate);
                }            
            }
       
        }

        return form26Information;
    }
 
}

</script>

<style scoped lang="scss" src="@/styles/_pdf.scss">

</style>